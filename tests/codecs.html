<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
  </head>
  <body>
    <h1>Test: Media Codecs</h1>
    <p>Tests for the availability & support of media codecs.</p>
    <hr>
    <ul id="results"></ul>
    <script>
      const list = document.getElementById("results");
      function logList(success, text, result) {
        const li = document.createElement("li");
        if (success != null) { li.classList.add(success ? "success" : "fail"); }
        li.innerHTML = `<strong>${text}</strong>`;
        if (result != "") { li.innerHTML += ` - <code>${result}</code>`; }
        list.appendChild(li);
      }
      function logHeader(text) {
        const h = document.createElement("h2");
        h.innerHTML = text;
        list.appendChild(h);
      }
      function addResult(text, success) {
        logList(success, text, success ? "Supported" : "Unsupported");
      }
      logHeader("Audio");
      addResult("MP3 (Open)", !!document.createElement("audio").canPlayType("audio/mpeg"));
      addResult("OGG (Open)", !!document.createElement("audio").canPlayType("audio/ogg"));
      addResult("Opus (Open)", !!document.createElement("audio").canPlayType("audio/ogg; codecs=opus"));
      addResult("AAC (Proprietary)", !!document.createElement("audio").canPlayType("audio/aac"));
      addResult("WAV / PCM (Open)", !!document.createElement("audio").canPlayType("audio/wav"));
      addResult("FLAC (Open)", !!document.createElement("audio").canPlayType("audio/flac"));
      addResult("M4A / AAC-LC (Proprietary)", !!document.createElement("audio").canPlayType("audio/mp4; codecs=\"mp4a.40.2\""));

      logHeader("Video");
      addResult("H.265 / HEVC (Proprietary)", !!document.createElement("video").canPlayType("video/mp4; codecs=\"hev1.1.6.L93.B0\""));
      addResult("H.264 / MP4 (Proprietary)", !!document.createElement("video").canPlayType("video/mp4; codecs=\"avc1.42E01E\""));
      addResult("Theora / OGV (Open)", !!document.createElement("video").canPlayType("video/ogg; codecs=theora"));
      addResult("WebM / VP8 (Open)", !!document.createElement("video").canPlayType("video/webm; codecs=\"vp8\""));
      addResult("WebM / VP9 (Open)", !!document.createElement("video").canPlayType("video/webm; codecs=\"vp9\""));
      addResult("MPEG-2 (Proprietary)", !!document.createElement("video").canPlayType("video/mp2t; codecs=\"mp2v\""));
      addResult("HLS Streaming / M3U8 (Proprietary)", !!document.createElement("video").canPlayType("application/vnd.apple.mpegurl"));
      addResult("AV1 (Open)", !!document.createElement("video").canPlayType("video/mp4; codecs=\"av01.0.05M.08\""));

      logHeader("DRM");
      navigator.requestMediaKeySystemAccess("com.widevine.alpha", [{ videoCapabilities: [{ contentType: 'video/mp4; codecs="avc1.42E01E"' }] }]).then(() => {
        addResult("Widevine", true);
      }).catch(() => {
        addResult("Widevine", false);
      });
      navigator.requestMediaKeySystemAccess("org.w3.clearkey", [{ videoCapabilities: [{ contentType: 'video/mp4; codecs="avc1.42E01E"' }] }]).then(() => {
        addResult("ClearKey", true);
      }).catch(() => {
        addResult("ClearKey", false);
      });
      navigator.requestMediaKeySystemAccess("com.microsoft.playready", [{ videoCapabilities: [{ contentType: 'video/mp4; codecs="avc1.42E01E"' }] }]).then(() => {
        addResult("PlayReady", true);
      }).catch(() => {
        addResult("PlayReady", false);
      });
      navigator.requestMediaKeySystemAccess("com.apple.fps", [{ videoCapabilities: [{ contentType: 'video/mp4; codecs="avc1.42E01E"' }] }]).then(() => {
        addResult("FairPlay", true);
      }).catch(() => {
        addResult("FairPlay", false);
      });
      navigator.requestMediaKeySystemAccess("com.huawei.wiseplay", [{ videoCapabilities: [{ contentType: 'video/mp4; codecs="avc1.42E01E"' }] }]).then(() => {
        addResult("WisePlay", true);
      }).catch(() => {
        addResult("WisePlay", false);
      });
    </script>
  </body>
</html>
